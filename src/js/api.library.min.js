var api=api||{};api.spinner={};api.spinner.count=0;api.spinner.progress={};api.spinner.progress.instance=null;api.spinner.progress.timeout=0;api.spinner.start=function(pItemSpinner=null){if(pItemSpinner!=null){$(pItemSpinner).find(".item-spinner").remove();var item=$("#spinner-holder").find(".item-spinner").clone();$(pItemSpinner).prepend($(item));$(item).removeClass("d-none");$(pItemSpinner).find(".item-spinner").show();let resizeObserver=new ResizeObserver((()=>{$(pItemSpinner).find(item).find(".item-loader").css("margin-top",$(pItemSpinner).height()*.5-15)}));resizeObserver.observe($(pItemSpinner)[0])}else if(!api.spinner.count++){$("#spinner").show()}};api.spinner.stop=function(pItemSpinner=null){if(pItemSpinner!=null){$(pItemSpinner).find(".item-spinner").find(".item-loader").addClass("d-none");$(pItemSpinner).find(".item-spinner").remove()}else{if(api.spinner.count){api.spinner.count--}if(!api.spinner.count){if(api.spinner.progress.instance){api.spinner.progress.stop();setTimeout((function(){$("#spinner").fadeOut("slow")}),1e3)}else{$("#spinner").fadeOut("slow")}}}};api.spinner.progress.start=function(progressTimeout){if(progressTimeout){clearTimeout(api.spinner.progress.instance);api.spinner.progress.timeout=progressTimeout;$("#spinner .progress").find("[name=bar]").css("width","1%").attr("aria-valuenow",1);$("#spinner .progress").find("[name=percentage]").text("1%");$("#spinner .progress").show();api.spinner.progress.setTimeout()}};api.spinner.progress.stop=function(){clearTimeout(api.spinner.progress.instance);$("#spinner .progress").find("[name=bar]").css("width","100%").attr("aria-valuenow",100);$("#spinner .progress").find("[name=percentage]").text("100%");$("#spinner .progress").fadeOut("slow")};api.spinner.progress.getTimeout=function(unitsToProcess,unitsPerSecond){var timeout=unitsToProcess/unitsPerSecond;timeout=timeout/100*1*1e3;return timeout};api.spinner.progress.setTimeout=function(){api.spinner.progress.timeout=Math.ceil(api.spinner.progress.timeout+api.spinner.progress.timeout/100*.5);api.spinner.progress.instance=setTimeout((function(){var percentage=Math.min(parseInt($("#spinner .progress").find("[name=bar]").attr("aria-valuenow"))+1,99);$("#spinner .progress").find("[name=bar]").css("width",percentage+"%").attr("aria-valuenow",percentage);$("#spinner .progress").find("[name=percentage]").text(percentage+"%");api.spinner.progress.setTimeout()}),api.spinner.progress.timeout)};api.content={};api.content.params={};api.content.getParam=function(pKey){return api.content.params[pKey]};api.content.load=function(pSelectorContainer,pRelativeURL,pParams,pAppend){pParams=pParams||{};pAppend=pAppend||false;var uri=new URI(pRelativeURL);if(uri.is("relative")===false)return;$.ajax({url:pRelativeURL,async:false,success:function(response){api.content.params=pParams;if(pAppend)$(pSelectorContainer).append(response).promise().done((function(){api.content.params={}}));else $(pSelectorContainer).empty().html(response).promise().done((function(){api.content.params={}}))}})};api.content.navigate=function(pNavSelector,pRelativeURL,pNav_link_SelectorToHighlight,pNav_menu_SelectorToHighlight){pNav_link_SelectorToHighlight=pNav_link_SelectorToHighlight||null;pNav_menu_SelectorToHighlight=pNav_menu_SelectorToHighlight||null;var uri=new URI(pRelativeURL);if(uri.is("relative")===false)return;$(pNavSelector).click((function(e){e.preventDefault();$.ajax({url:pRelativeURL,async:false,success:function(response){$("#body").hide().empty().html(response).fadeIn()}});$("#navigation").find("*").removeClass("show");$("#navigation").find("*").removeClass("active");if(pNav_link_SelectorToHighlight)$(pNav_link_SelectorToHighlight).addClass("active");if(pNav_menu_SelectorToHighlight){$(pNav_menu_SelectorToHighlight).addClass("active")}}))};api.content.goTo=function(pRelativeURL,pNav_link_SelectorToHighlight,pNav_menu_SelectorToHighlight,pParams){pNav_link_SelectorToHighlight=pNav_link_SelectorToHighlight||null;pNav_menu_SelectorToHighlight=pNav_menu_SelectorToHighlight||null;pParams=pParams||{};var uri=new URI(pRelativeURL);if(uri.is("relative")===false)return;$.ajax({url:pRelativeURL,async:false,success:function(response){api.content.params=pParams;$("#body").hide().empty().html(response).fadeIn().promise().done((function(){api.content.params={}}))}});$("#navigation").find("*").removeClass("show");$("#navigation").find("*").removeClass("active");if(pNav_link_SelectorToHighlight)$(pNav_link_SelectorToHighlight).addClass("active");if(pNav_menu_SelectorToHighlight){$(pNav_menu_SelectorToHighlight).addClass("active")}};api.ajax={};api.ajax.callback=function(pFunction,pResponse,pParams){pResponse=pResponse||null;pParams=pParams||{};var context=window;var callbackFunction="";callbackFunction=context[pFunction];if(typeof callbackFunction==="function"){if(jQuery.isEmptyObject(pParams))return callbackFunction(pResponse);else return callbackFunction(pResponse,pParams)}var namespaces=pFunction.split(".");var functionName=namespaces.pop();for(var i=0;i<namespaces.length;i++){context=context[namespaces[i]]}if(context){callbackFunction=context[functionName];if(jQuery.isEmptyObject(pParams))return callbackFunction(pResponse);else return callbackFunction(pResponse,pParams)}return false};api.ajax.config=function(pUrl,pCallback,pAjaxParams,pErrorCallback){pAjaxParams=pAjaxParams||{};pAjaxParams.method=pAjaxParams.method||"GET";pAjaxParams.dataType=pAjaxParams.dataType||"json";pAjaxParams.jsonp=pAjaxParams.jsonp||false;pAjaxParams.timeout=pAjaxParams.timeout||6e4;pAjaxParams.async=pAjaxParams.async||false;ajaxParams={url:pUrl,success:function(response){pCallback(response)},error:function(jqXHR,textStatus,errorThrown){console.log('An Internal Server has occurred: the configuration file "'+pUrl+'" is missing or invalid.');if(pErrorCallback){pErrorCallback()}}};$.extend(ajaxParams,pAjaxParams);$.ajax(ajaxParams)};api.ajax.jsonrpc={};api.ajax.jsonrpc.request=function(pAPI_URL,pAPI_Method,pAPI_Params,callbackFunctionName_onSuccess,callbackParams_onSuccess,callbackFunctionName_onError,callbackParams_onError,pAJAX_Params,pItemSpinner=null,pHideSuccessErrorModal=false){api.ajax.jsonrpc.processRequestAsync(pAPI_URL,pAPI_Method,pAPI_Params,callbackFunctionName_onSuccess,callbackParams_onSuccess,callbackFunctionName_onError,callbackParams_onError,pAJAX_Params,pItemSpinner,pHideSuccessErrorModal)};api.ajax.jsonrpc.processRequestAsync=async function(pAPI_URL,pAPI_Method,pAPI_Params,callbackFunctionName_onSuccess,callbackParams_onSuccess,callbackFunctionName_onError,callbackParams_onError,pAJAX_Params,pItemSpinner=null,pHideSuccessErrorModal=false){pAPI_Params=pAPI_Params||{};callbackFunctionName_onSuccess=callbackFunctionName_onSuccess||null;callbackFunctionName_onError=callbackFunctionName_onError||null;callbackParams_onSuccess=callbackParams_onSuccess||null;callbackParams_onError=callbackParams_onError||null;pAJAX_Params=pAJAX_Params||{};pAJAX_Params.method=pAJAX_Params.method||"POST";pAJAX_Params.dataType=pAJAX_Params.dataType||"json";pAJAX_Params.jsonp=pAJAX_Params.jsonp||false;pAJAX_Params.timeout=pAJAX_Params.timeout||18e4;var simulateSync=pAJAX_Params.async===undefined?false:!pAJAX_Params.async;pAJAX_Params.async=true;var callID=Math.floor(Math.random()*999999999)+1;var data4Ajax={jsonrpc:"2.0",method:pAPI_Method,params:pAPI_Params,id:callID};var extendedAJAXParams={url:pAPI_URL,data:JSON.stringify(data4Ajax),xhrFields:{withCredentials:true},success:function(response){if(pAJAX_Params.dataType=="json"&&response.id!=callID){api.modal.exception("An invalid JSON-RPC Identifier has been detected. Please try again.");return}if(response.error){if(!pHideSuccessErrorModal){var errorOutput=null;if(response.error.data){if($.isArray(response.error.data)&&response.error.data.length||$.isPlainObject(response.error.data)&&!$.isEmptyObject(response.error.data)){errorOutput=$("<ul>",{class:"list-group"});$.each(response.error.data,(function(_index,value){var error=$("<li>",{class:"list-group-item",html:value.toString()});errorOutput.append(error)}))}else errorOutput=response.error.data}else{errorOutput=response.error.message}api.modal.error(errorOutput)}if(callbackFunctionName_onError){api.ajax.callback(callbackFunctionName_onError,response.error,callbackParams_onError)}}else if(response.result!==undefined){if(callbackFunctionName_onSuccess)api.ajax.callback(callbackFunctionName_onSuccess,response.result,callbackParams_onSuccess)}else api.modal.exception("An unexpected error has occurred. Please try again.")},error:function(jqXHR,textStatus,errorThrown){if(callbackFunctionName_onError){api.ajax.callback(callbackFunctionName_onError,null,callbackParams_onError)}else if(errorThrown=="Unauthorized"){}else{api.modal.exception("A Server or Network Error has occurred. Please try again.")}},complete:function(){if(simulateSync)api.spinner.stop(pItemSpinner);$("#nav-loader").addClass("invisible");$("body").css("cursor","default")}};let headers=pAJAX_Params.headers||{};try{const token=await api.sso.acquireAccessTokenSilently(pAPI_Method);if(token){headers["MSAL"]=`Bearer ${token}`}extendedAJAXParams.headers=headers;$.extend(true,extendedAJAXParams,pAJAX_Params);$("#nav-loader").removeClass("invisible");$("body").css("cursor","progress");if(simulateSync)api.spinner.start(pItemSpinner);api.cookie.session.extend();return $.ajax(extendedAJAXParams)}catch(error){console.log(error);api.modal.exception("An unhandled Ajax exception has occurred. Please try again.");return false}};api.modal={};api.modal.confirm=function(pMessage,pCallbackMethod,pCallbackParams,pIconType,pCancellationCallbackMethod,pCancellationCallbackParams){var msgObj;if(typeof pMessage=="string"){try{msgObj=JSON.parse(pMessage)}catch(ex){msgObj=pMessage}}else{msgObj=pMessage}if(msgObj.hasOwnProperty("title")){$("#modal-confirm").find("[name=message-text]").empty().html(msgObj.title)}else{$("#modal-confirm").find("[name=message-text]").empty().html(msgObj)}if(msgObj.hasOwnProperty("message")){$("#modal-confirm").find("[name=message-content]").empty().html(msgObj.message)}else{$("#modal-confirm").find("[name=message-content]").empty()}let iconType="";$("#modal-confirm").find("[name=confirm-btn]").removeClass();if(pIconType=="error"){iconType="far fa-times-circle text-danger";$("#modal-confirm").find("[name=confirm-btn]").addClass("btn btn-danger text-light")}else if(pIconType=="question"){iconType="fa fa-question-circle text-primary";$("#modal-confirm").find("[name=confirm]").addClass("btn border-primary btn-primary text-light")}else{iconType="fa fa-info-circle text-warning";$("#modal-confirm").find("[name=confirm]").removeClass().addClass("btn btn-warning")}$("#modal-confirm").find("[name=icon-type]").removeClass().addClass(iconType+" fa-5x");$("#modal-confirm").find("[name=confirm]").once("click",(function(){$("#modal-confirm").modal("hide").delay(100).queue((function(){pCallbackMethod(pCallbackParams);$(this).dequeue()}))}));$("#modal-confirm").find("[name=cancel-confirm]").once("click",(function(){$("#modal-confirm").modal("hide").delay(100).queue((function(){if(pCancellationCallbackMethod!=null){pCancellationCallbackMethod(pCancellationCallbackParams)}$(this).dequeue()}))}));$("#modal-confirm").modal("show")};api.modal.success=function(pMessage){var msgObj;if(typeof pMessage=="string"){try{msgObj=JSON.parse(pMessage)}catch(ex){msgObj=pMessage}}else{msgObj=pMessage}if(msgObj.hasOwnProperty("title")){$("#modal-success").find("[name=message-text]").empty().html(msgObj.title)}else{$("#modal-success").find("[name=message-text]").empty().html(msgObj)}if(msgObj.hasOwnProperty("message")){$("#modal-success").find("[name=message-content]").empty().html(msgObj.message)}else{$("#modal-success").find("[name=message-content]").empty()}$("#modal-success").find("[name=success]").once("click",(function(){$("#modal-success").modal("hide");$(".modal-hidden").removeClass("d-none")}));$("#modal-success").on("hidden.bs.modal",(function(){$(".modal-hidden").removeClass("d-none")}));$("#modal-success").modal("show")};api.modal.error=function(pMessage){var msgObj;if(typeof pMessage=="string"){try{msgObj=JSON.parse(pMessage)}catch(ex){msgObj={title:pMessage}}}else{msgObj=pMessage}if(Array.isArray(msgObj)){msgObj=msgObj[0]}$("#modal-error").find("[name=message-content]").empty();$("#modal-error").find("[name=more-info-content]").addClass("d-none");if(typeof pMessage=="object"){if(msgObj.hasOwnProperty("title")){$("#modal-error").find("[name=message-text]").empty().html(msgObj.title)}else{$("#modal-error").find("[name=message-text]").empty().html(msgObj)}}else{$("#modal-error").find("[name=message-text]").empty().html(msgObj.title)}if(msgObj.hasOwnProperty("message")){$("#modal-error").find("[name=message-content]").empty().html(msgObj.message);$("#modal-error").find("[name=message-uuid]").empty().html(msgObj.uuid)}$("#modal-error").find("[name=error]").once("click",(function(){$("#modal-error").modal("hide");$(".modal-hidden").removeClass("d-none")}));$("#modal-error").on("hidden.bs.modal",(function(){$(".modal-hidden").removeClass("d-none")}));$("#modal-error").modal("show")};api.modal.information=function(pMessage){var msgObj;if(typeof pMessage=="string"){try{msgObj=JSON.parse(pMessage)}catch(ex){msgObj=pMessage}}else{msgObj=pMessage}if(msgObj.hasOwnProperty("title")){$("#modal-information").find("[name=message-text]").empty().html(msgObj.title)}else{$("#modal-information").find("[name=message-text]").empty().html(msgObj)}if(msgObj.hasOwnProperty("message")){$("#modal-information").find("[name=message-content]").empty().html(msgObj.message)}else{$("#modal-information").find("[name=message-content]").empty()}$("#modal-information").find("[name=information]").once("click",(function(){$("#modal-information").modal("hide");$(".modal-hidden").removeClass("d-none")}));$("#modal-information").on("hidden.bs.modal",(function(){$(".modal-hidden").removeClass("d-none")}));$("#modal-information").modal("show")};api.modal.warning=function(pMessage){var msgObj;if(typeof pMessage=="string"){try{msgObj=JSON.parse(pMessage)}catch(ex){msgObj=pMessage}}else{msgObj=pMessage}if(msgObj.hasOwnProperty("title")){$("#modal-warning").find("[name=message-text]").empty().html(msgObj.title)}else{$("#modal-warning").find("[name=message-text]").empty().html(msgObj)}if(msgObj.hasOwnProperty("message")){$("#modal-warning").find("[name=message-content]").empty().html(msgObj.message)}else{$("#modal-warning").find("[name=message-content]").empty()}$("#modal-warning").find("[name=warning]").once("click",(function(){$("#modal-warning").modal("hide");$(".modal-hidden").removeClass("d-none")}));$("#modal-warning").on("hidden.bs.modal",(function(){$(".modal-hidden").removeClass("d-none")}));$("#modal-warning").modal("show")};api.modal.exception=function(pMessage){var msgObj;if(typeof pMessage=="string"){try{msgObj=JSON.parse(pMessage)}catch(ex){msgObj=pMessage}}else{msgObj=pMessage}if(msgObj.hasOwnProperty("title")){$("#modal-exception").find("[name=message-text]").empty().html(msgObj.title)}else{$("#modal-exception").find("[name=message-text]").empty().html(msgObj)}if(msgObj.hasOwnProperty("message")){$("#modal-exception").find("[name=message-content]").empty().html(msgObj.message)}else{$("#modal-exception").find("[name=message-content]").empty()}$("#modal-exception").find("[name=exception]").once("click",(function(){$("#modal-exception").modal("hide");$(".modal-hidden").removeClass("d-none")}));$("#modal-exception").on("hidden.bs.modal",(function(){$(".modal-hidden").removeClass("d-none")}));$("#modal-exception").modal("show")};api.uri={};api.uri.parse=function(pURL){var URI=new URI(pURL);return URI.parseQuery(uri.search())};api.uri.isParam=function(pParam,pURL){pURL=pURL||window.location.href;var uri=new URI(pURL);var paramsURL=URI.parseQuery(uri.search());if(pParam in paramsURL)return true;else return false};api.uri.getParam=function(pParam,pURL){pURL=pURL||window.location.href;var uri=new URI(pURL);var paramsURL=URI.parseQuery(uri.search());if(pParam in paramsURL)return paramsURL[pParam];else return false};api.uri.getNoHeader=function(){return api.uri.isParam(C_API_URI_NOHEADER)};api.uri.getNoNavbar=function(){return api.uri.isParam(C_API_URI_NONAVBAR)};api.uri.getNoFooter=function(){return api.uri.isParam(C_API_URI_NOFOOTER)};api.uri.getBody=function(){return api.uri.getParam(C_API_URI_BODY)};api.cookie={};api.cookie.session={};api.cookie.session.data={length:null,expiry:null,logoutEndpoint:null,logoutMethod:null};api.cookie.session.options={path:"/",secure:"true",sameSite:"strict"};api.cookie.session.confirmExtension=function(){};api.cookie.session.start=function(pLength,pLogoutEnpoint,pLogoutMethod){var timestamp=Math.round((new Date).getTime()/1e3);Cookies.setJSON(C_API_COOKIE_SESSION,$.extend(true,{},api.cookie.session.data,{length:pLength,expiry:timestamp+pLength,logoutEndpoint:pLogoutEnpoint,logoutMethod:pLogoutMethod}),api.cookie.session.options);window.setInterval(api.cookie.session.intervalRoutine,1e3)};api.cookie.session.extend=function(){var data=Cookies.getJSON(C_API_COOKIE_SESSION);if(data){var timestamp=Math.round((new Date).getTime()/1e3);Cookies.setJSON(C_API_COOKIE_SESSION,$.extend(true,{},data,{length:data.length,expiry:timestamp+data.length}),api.cookie.session.options)}};api.cookie.session.end=function(logoutEndpoint,logoutMethod){logoutEndpoint=logoutEndpoint||null;logoutMethod=logoutMethod||null;var session=Cookies.getJSON(C_API_COOKIE_SESSION);api.ajax.jsonrpc.request(logoutEndpoint||session.logoutEndpoint,logoutMethod||session.logoutMethod,null,"api.cookie.session.endCallbak");Cookies.remove(C_API_COOKIE_SESSION)};api.cookie.session.endCallbak=function(data){if(data==C_API_AJAX_SUCCESS){window.location.href=window.location.pathname}else{api.modal.exception("An unexpected error has occurred. Please try again.")}};api.cookie.session.intervalRoutine=function(){var data=Cookies.getJSON(C_API_COOKIE_SESSION);if(!data||$.active){return}var timestamp=Math.round((new Date).getTime()/1e3);if(timestamp>data.expiry){api.cookie.session.end()}else if(timestamp>data.expiry-60){api.cookie.session.confirmExtension()}else{}};api.sso={};api.sso.msalConfigObj={};api.sso.msalInstance=null;api.sso.tokenPromise=null;api.sso.response=null;api.sso.authenticateUserSilently=function(callbackFunctionName_onSuccess,callbackFunctionName_onError,hideLoginPopup){api.spinner.start();hideLoginPopup=hideLoginPopup||false;let loginRequest={scopes:["api://"+api.sso.msalConfigObj.auth.clientId+"/access_application"]};api.sso.msalInstance.ssoSilent(loginRequest).then((response=>{api.spinner.stop();console.log(response.accessToken);api.sso.response=response;api.ajax.callback(callbackFunctionName_onSuccess,response)})).catch((error=>{api.spinner.stop();console.log("Silent Error: "+error);if(hideLoginPopup){if(callbackFunctionName_onError!=null){api.ajax.callback(callbackFunctionName_onError,error)}}else if(error instanceof msal.InteractionRequiredAuthError){console.log("SSO Silent requires interation. prompting login....");api.sso.authenticateUserPopup(callbackFunctionName_onSuccess,callbackFunctionName_onError)}else{if(callbackFunctionName_onError!=null){api.ajax.callback(callbackFunctionName_onError,error)}}}))};api.sso.authenticateUserPopup=function(callbackFunctionName_onSuccess,callbackFunctionName_onError){console.log("authenticateUserPopup");let loginRequest={scopes:["api://"+api.sso.msalConfigObj.auth.clientId+"/access_application"]};api.spinner.start();api.sso.msalInstance.loginPopup(loginRequest).then((response=>{api.spinner.stop();console.log(response.accessToken);api.ajax.callback(callbackFunctionName_onSuccess,response)})).catch((error=>{api.spinner.stop();console.log("login failed:",error);api.ajax.callback(callbackFunctionName_onError,error)}))};api.sso.authenticateUserPopupAsync=async function(){console.log("authenticateUserPopup");let loginRequest={scopes:["api://"+api.sso.msalConfigObj.auth.clientId+"/access_application"]};try{return await api.sso.msalInstance.loginPopup(loginRequest)}catch(error){console.log("login failed:",error);return null}};api.sso.logout=function(callbackFunctionName_onSuccess,callbackFunctionName_onError){callbackFunctionName_onSuccess=callbackFunctionName_onSuccess||null;callbackFunctionName_onError=callbackFunctionName_onError||null;const logoutRequest={account:api.sso.getMsalAccount()};api.sso.msalInstance.logoutPopup(logoutRequest).then((()=>{if(callbackFunctionName_onSuccess){api.ajax.callback(callbackFunctionName_onSuccess)}})).catch((error=>{if(callbackFunctionName_onError){api.ajax.callback(callbackFunctionName_onError,error)}}))};api.sso.acquireAccessTokenSilently=function(pAPI_Method){console.log("get access token silently");const validAccount=api.sso.getMsalAccount();if(validAccount){api.sso.msalInstance.setActiveAccount(validAccount)}else{return null}console.log(api.sso.tokenPromise);if(api.sso.tokenPromise)return api.sso.tokenPromise;let scope=["api://"+api.sso.msalConfigObj.auth.clientId+"/access_application"];api.sso.tokenPromise=api.sso.msalInstance.acquireTokenSilent({scopes:scope,account:api.sso.msalInstance.getActiveAccount(),forceRefresh:true}).then((response=>{api.sso.tokenPromise=null;console.log(response.expiresOn);console.log("finished2 =>"+pAPI_Method);return response.accessToken})).catch((async error=>{if(error instanceof msal.InteractionRequiredAuthError){const response=await api.sso.authenticateUserPopupAsync();api.sso.tokenPromise=null;if(response.accessToken){return response.accessToken}else{return null}}else{api.sso.tokenPromise=null;return null}}));console.log("finished1 =>"+pAPI_Method);return api.sso.tokenPromise};api.sso.getMsalAccount=function(){if(api.sso.msalInstance==null){return null}const accounts=api.sso.msalInstance.getAllAccounts();const validAccount=accounts.find((account=>{const idTokenClaims=account.idTokenClaims;return idTokenClaims&&idTokenClaims.aud===api.sso.msalConfigObj.auth.clientId}));return validAccount};